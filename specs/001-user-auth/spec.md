# Feature Specification: 사용자 인증 시스템 (User Authentication System)

**Feature Branch**: `001-user-auth`
**Created**: 2026-01-13
**Status**: Draft
**Input**: User description: "사용자 인증 시스템 - NextAuth.js 기반 이메일/소셜 로그인(Google, Kakao), JWT 세션, Student/Mentor/Admin 역할 구분, 보호된 라우트 미들웨어"

---

## User Scenarios & Testing

### User Story 1 - 학생 회원가입 및 로그인 (Priority: P1)

미술 입시생이 플랫폼에 가입하여 커뮤니티와 멘토 피드백 서비스에 접근할 수 있다.

**Why this priority**: 학생은 플랫폼의 주요 사용자이며, 회원가입 없이는 어떤 기능도 사용할 수 없다. 가장 기본적인 진입점이다.

**Independent Test**: 학생이 이메일 또는 소셜 계정으로 회원가입하고, 로그인하여 커뮤니티 페이지에 접근하는 것으로 테스트 가능.

**Acceptance Scenarios**:

1. **Given** 미가입 사용자가 회원가입 페이지에 있을 때, **When** 이메일과 비밀번호를 입력하고 회원가입 버튼을 클릭하면, **Then** 계정이 생성되고 Student 역할로 자동 로그인된다.
2. **Given** 미가입 사용자가 회원가입 페이지에 있을 때, **When** Google 로그인 버튼을 클릭하고 Google 인증을 완료하면, **Then** 계정이 생성되고 Student 역할로 자동 로그인된다.
3. **Given** 미가입 사용자가 회원가입 페이지에 있을 때, **When** Kakao 로그인 버튼을 클릭하고 Kakao 인증을 완료하면, **Then** 계정이 생성되고 Student 역할로 자동 로그인된다.
4. **Given** 기존 회원이 로그인 페이지에 있을 때, **When** 올바른 자격 증명을 입력하면, **Then** 로그인되어 메인 페이지로 이동한다.

---

### User Story 2 - 역할 기반 접근 제어 (Priority: P1)

시스템이 사용자의 역할(Student, Mentor, Admin)에 따라 적절한 페이지와 기능에 대한 접근을 제어한다.

**Why this priority**: 역할 구분이 없으면 멘토 인증 워크플로우, 관리자 대시보드 등 핵심 기능을 분리할 수 없다.

**Independent Test**: 각 역할의 사용자가 허용된 페이지에만 접근 가능하고, 비허용 페이지 접근 시 적절히 차단되는지 테스트 가능.

**Acceptance Scenarios**:

1. **Given** Student 역할의 로그인 사용자가 있을 때, **When** 커뮤니티 페이지에 접근하면, **Then** 정상적으로 페이지가 표시된다.
2. **Given** Student 역할의 로그인 사용자가 있을 때, **When** Admin 대시보드에 접근하려고 하면, **Then** 접근이 거부되고 적절한 안내 메시지가 표시된다.
3. **Given** Mentor(Active) 역할의 로그인 사용자가 있을 때, **When** 피드백 작성 페이지에 접근하면, **Then** 정상적으로 페이지가 표시된다.
4. **Given** Admin 역할의 로그인 사용자가 있을 때, **When** Admin 대시보드에 접근하면, **Then** 정상적으로 관리 페이지가 표시된다.

---

### User Story 3 - 보호된 라우트 미들웨어 (Priority: P2)

비로그인 사용자가 보호된 페이지에 접근하려고 할 때 로그인 페이지로 리다이렉트된다.

**Why this priority**: 인증되지 않은 사용자의 무단 접근을 방지하는 보안의 기본이다. P1 기능이 완료된 후에 의미가 있다.

**Independent Test**: 비로그인 상태에서 보호된 URL에 직접 접근 시 로그인 페이지로 리다이렉트되고, 로그인 후 원래 URL로 돌아오는지 테스트 가능.

**Acceptance Scenarios**:

1. **Given** 비로그인 사용자가 있을 때, **When** 보호된 페이지 URL을 직접 입력하면, **Then** 로그인 페이지로 리다이렉트된다.
2. **Given** 비로그인 사용자가 로그인 페이지로 리다이렉트되었을 때, **When** 로그인에 성공하면, **Then** 원래 접근하려던 페이지로 자동 이동한다.
3. **Given** 로그인된 사용자가 있을 때, **When** 세션이 만료되면, **Then** 다음 보호된 페이지 접근 시 로그인 페이지로 리다이렉트된다.

---

### User Story 4 - 세션 관리 (Priority: P2)

사용자의 로그인 상태가 안전하게 유지되고, 로그아웃 시 세션이 완전히 종료된다.

**Why this priority**: 세션 관리는 보안의 핵심이지만, 기본 로그인/회원가입이 먼저 구현되어야 한다.

**Independent Test**: 로그인 후 브라우저를 닫았다 다시 열어도 로그인 상태가 유지되고, 로그아웃 후에는 완전히 세션이 종료되는지 테스트 가능.

**Acceptance Scenarios**:

1. **Given** 로그인된 사용자가 있을 때, **When** 브라우저를 닫고 다시 열면, **Then** 로그인 상태가 유지된다 (세션 만료 전).
2. **Given** 로그인된 사용자가 있을 때, **When** 로그아웃 버튼을 클릭하면, **Then** 세션이 종료되고 로그인 페이지로 이동한다.
3. **Given** 로그아웃한 사용자가 있을 때, **When** 뒤로가기 버튼을 누르면, **Then** 보호된 페이지의 캐시된 내용이 표시되지 않는다.

---

### User Story 5 - 기존 소셜 계정 연동 (Priority: P3)

이메일로 가입한 사용자가 나중에 소셜 계정을 연동하거나, 동일 이메일의 소셜 계정으로 로그인할 수 있다.

**Why this priority**: 사용자 편의 기능으로, 핵심 인증 흐름이 완성된 후 추가되어도 충분하다.

**Independent Test**: 이메일로 가입한 계정에 Google/Kakao 계정을 연동하고, 이후 소셜 로그인으로도 같은 계정에 접근 가능한지 테스트 가능.

**Acceptance Scenarios**:

1. **Given** 이메일로 가입한 사용자가 있을 때, **When** 동일한 이메일의 Google 계정으로 로그인하면, **Then** 기존 계정으로 로그인된다 (새 계정 생성 안 함).
2. **Given** 로그인된 사용자가 설정 페이지에 있을 때, **When** 소셜 계정 연동 버튼을 클릭하면, **Then** 해당 소셜 계정이 현재 계정에 연동된다.

---

### Edge Cases

- 사용자가 이미 존재하는 이메일로 회원가입을 시도하면 어떻게 되는가? → 중복 이메일 오류 메시지 표시
- 소셜 로그인 중 사용자가 취소하면 어떻게 되는가? → 로그인 페이지로 돌아가며 적절한 메시지 표시
- 비밀번호를 잘못 입력하면 어떻게 되는가? → 오류 메시지 표시, 5회 연속 실패 시 일시적 계정 잠금
- 세션 토큰이 탈취되면 어떻게 되는가? → 24시간 토큰 만료로 피해 기간 제한 (갱신 메커니즘은 추후 확장)
- Admin이 삭제되거나 역할이 변경되면 어떻게 되는가? → 즉시 해당 역할 권한 상실
- OAuth 제공자(Google/Kakao) 장애 시 어떻게 되는가? → 일반 오류 메시지 표시 + 이메일 로그인 대안 안내

---

## Requirements

### Functional Requirements

- **FR-001**: 시스템은 이메일과 비밀번호를 통한 회원가입을 지원해야 한다.
- **FR-002**: 시스템은 Google OAuth를 통한 회원가입/로그인을 지원해야 한다.
- **FR-003**: 시스템은 Kakao OAuth를 통한 회원가입/로그인을 지원해야 한다.
- **FR-004**: 시스템은 이메일 주소의 유효성을 검증해야 한다.
- **FR-005**: 시스템은 비밀번호 강도 규칙을 적용해야 한다 (최소 8자, 영문/숫자 포함).
- **FR-006**: 시스템은 세 가지 사용자 역할을 구분해야 한다: Student, Mentor, Admin.
- **FR-007**: 새로 가입하는 사용자는 기본적으로 Student 역할을 부여받아야 한다.
- **FR-008**: 시스템은 JWT 기반의 세션 관리를 제공해야 한다 (토큰 유효 기간: 24시간).
- **FR-009**: 시스템은 역할에 따라 페이지 접근을 제어하는 미들웨어를 제공해야 한다.
- **FR-010**: 비로그인 사용자가 보호된 페이지에 접근하면 로그인 페이지로 리다이렉트해야 한다.
- **FR-011**: 로그인 성공 후 원래 접근하려던 페이지로 리다이렉트해야 한다.
- **FR-012**: 시스템은 로그아웃 기능을 제공해야 한다.
- **FR-013**: 동일한 이메일 주소로 중복 회원가입을 방지해야 한다.
- **FR-014**: 5회 연속 로그인 실패 시 해당 계정을 15분간 일시 잠금해야 한다.
- **FR-015**: 시스템은 사용자 정보(이메일, 역할, 프로필)를 안전하게 저장해야 한다.
- **FR-016**: 시스템은 보안 관련 이벤트(로그인 성공/실패, 역할 변경)에 대한 감사 로그를 기록해야 한다.

### Key Entities

- **User**: 플랫폼 사용자를 나타낸다. 이메일, 비밀번호 해시(bcrypt), 역할(Student/Mentor/Admin), 프로필 이미지, 이름, 생성일, 마지막 로그인 일시를 포함한다.
- **Account**: 소셜 로그인 연동 정보를 나타낸다. 사용자와 연결되며, 제공자(Google/Kakao), 제공자 계정 ID를 포함한다.
- **Session**: 사용자의 로그인 세션을 나타낸다. 세션 토큰, 만료 시간, 사용자 연결 정보를 포함한다.

---

## Success Criteria

### Measurable Outcomes

- **SC-001**: 사용자는 2분 이내에 회원가입 과정을 완료할 수 있다.
- **SC-002**: 소셜 로그인(Google/Kakao)은 3번의 클릭 이내에 완료된다.
- **SC-003**: 95% 이상의 로그인 시도가 2초 이내에 응답을 받는다.
- **SC-004**: 보호된 페이지 접근 시 권한 확인이 500ms 이내에 완료된다.
- **SC-005**: 로그아웃 후 보호된 페이지 접근 시 100% 리다이렉트가 발생한다.
- **SC-006**: 동시 접속 사용자 1,000명을 지원한다.

---

## Assumptions

- 이메일 인증(verification)은 MVP 범위에서 제외하며, 추후 확장한다.
- 비밀번호 재설정 기능은 별도 Spec으로 분리하여 구현한다.
- Mentor 역할 전환(Student → Mentor)은 별도 "멘토 인증 워크플로우" Spec에서 다룬다.
- 회원가입 시 포인트 지급은 별도 "포인트 시스템" Spec에서 다룬다.
- Admin 계정은 시스템 초기화 시 수동으로 생성하거나, 시드 데이터로 제공한다.
- 데이터베이스는 PostgreSQL을 사용하며, Prisma ORM으로 접근한다.

---

## Dependencies

- 없음 (첫 번째 구현 기능)

---

## Out of Scope

- 이메일 인증 (Email Verification)
- 비밀번호 재설정 (Password Reset)
- 2단계 인증 (2FA)
- Mentor 인증 워크플로우 (별도 Spec)
- 포인트 지급 (별도 Spec)
- 프로필 편집 기능

---

## Clarifications

### Session 2026-01-13

- Q: JWT 세션 토큰의 유효 기간(lifetime)은 얼마로 설정해야 하나요? → A: 1일 (24시간, 높은 보안 우선)
- Q: 비밀번호 해싱 알고리즘으로 무엇을 사용해야 하나요? → A: bcrypt (NextAuth.js 기본, 실전 검증됨)
- Q: 사용자 데이터 저장을 위한 데이터베이스는 무엇을 사용하나요? → A: PostgreSQL + Prisma
- Q: OAuth 제공자(Google/Kakao) 장애 시 사용자에게 어떻게 안내해야 하나요? → A: 일반 오류 + 이메일 로그인 대안 안내
- Q: 보안 관련 이벤트의 로깅 수준은 어떻게 해야 하나요? → A: 기본 감사 로그 (로그인 성공/실패, 역할 변경 기록)
